# 期货价格分析系统使用说明

## 项目概述

期货价格分析系统是一个基于Python的桌面应用程序，专门用于获取和分析期货市场数据。该系统能够从公开数据源获取期货和现货价格信息，进行价格位置分析，并通过可视化图表展示分析结果，帮助用户判断当前价格在历史数据中的相对位置，辅助投资决策。

## 功能特点

### 1. **数据获取功能**
- 支持自定义日期范围的期货数据获取
- 从专业期货数据网站实时抓取数据
- 自动解析和处理原始数据
- 支持多线程数据下载，避免界面卡顿

### 2. **价格分析功能**
- **价格位置分析**：计算当前价格在历史价格中的百分位
- **高低估判断**：基于百分位判断价格状态
  - 超过99%历史价格 → 价格极端高估
  - 超过80%历史价格 → 价格高估
  - 低于20%历史价格 → 价格低估
  - 低于1%历史价格 → 价格极端低估
- **基差分析**：计算现货与期货价格之间的基差
- **快速扫描**：一键分析所有商品的价格状态

### 3. **可视化功能**
- 四图联动的可视化界面
  - 期货价格走势图（带分位数线）
  - 现货价格走势图（带分位数线）
  - 基差走势图
  - 价格分布直方图
- 可滚动的图表区域，支持鼠标滚轮和滚动条导航
- 集成matplotlib工具栏，支持缩放、平移等操作

### 4. **数据管理功能**
- 数据导出为CSV格式
- 自动保存获取的数据
- 数据预览和摘要显示

## 系统要求

### 软件环境
- **操作系统**：Windows 7/8/10/11、macOS 10.12+ 或 Linux
- **Python版本**：Python 3.7或更高版本
- **网络连接**：需要互联网连接以获取数据

### Python依赖库
```
tkinter >= 8.6          # GUI界面
pandas >= 1.3.0         # 数据处理
numpy >= 1.21.0         # 数值计算
matplotlib >= 3.4.0     # 数据可视化
requests >= 2.26.0      # 网络请求
lxml >= 4.6.0           # HTML解析
scipy >= 1.7.0          # 统计分析（可选）
```

## 安装与运行

### 1. 安装Python依赖
```bash
pip install pandas numpy matplotlib requests lxml scipy
```

### 2. 运行程序
```bash
python futures_analysis.py
```

## 使用说明

### 1. **启动程序**
运行程序后，将显示主界面，包含以下区域：
- 控制面板（数据获取控制）
- 数据分析面板
- 分析结果显示区域
- 图表显示区域
- 状态栏

### 2. **获取数据**
1. 在"开始日期"和"结束日期"字段中输入日期（格式：YYYY-MM-DD）
2. 点击"获取期货数据"按钮
3. 等待数据获取完成（进度条显示进度）

### 3. **分析数据**
1. 从"选择商品"下拉列表中选择要分析的商品
2. 点击"分析价格位置"按钮
3. 查看分析结果和图表

### 4. **快速扫描**
- 点击"快速扫描全部商品"按钮，快速查看所有商品的价格状态
- 结果按高估/低估程度排序显示

### 5. **保存数据**
- 点击"保存数据到CSV"按钮，将获取的数据保存到本地文件

## 界面布局详解

### 控制面板区域
```
┌─────────────────────────────────────────────────────────────┐
│ 数据获取控制                                                  │
│ 开始日期: [2024-01-01]  结束日期: [2024-12-20] [获取期货数据] │
│ [==================== 进度条 ====================]          │
│ 状态: 就绪                                                   │
└─────────────────────────────────────────────────────────────┘
```

### 数据分析面板
```
┌─────────────────────────────────────────────────────────────┐
│ 数据分析                                                      │
│ 选择商品: [下拉列表] [分析价格位置] [保存数据到CSV] [快速扫描全部商品] │
└─────────────────────────────────────────────────────────────┘
```

### 分析结果显示区域
```
┌─────────────────────────────────────────────────────────────┐
│ 价格分析结果                                                  │
│ 【商品名称价格分析报告】                                        │
│ 分析日期: 2024-01-01 10:30:00                                │
│ 最新数据日期: 2024-12-20                                      │
│ 整体市场状态: 高估                                             │
│ 操作建议: 谨慎操作，可考虑部分减仓或观望                        │
│ ...                                                          │
└─────────────────────────────────────────────────────────────┘
```

### 图表显示区域
```
┌─────────────────────────────────────────────────────────────┐
│ 价格走势与分位分析                                              │
│  ┌─────┐ ┌─────┐                                            │
│  │图1  │ │图2  │  ← 期货价格走势 & 现货价格走势               │
│  └─────┘ └─────┘                                            │
│  ┌─────┐ ┌─────┐                                            │
│  │图3  │ │图4  │  ← 基差走势 & 价格分布直方图                 │
│  └─────┘ └─────┘                                            │
│  滚动条 ↑ 可使用鼠标滚轮或滚动条查看完整图表                     │
└─────────────────────────────────────────────────────────────┘
```

### 状态栏
```
┌─────────────────────────────────────────────────────────────┐
│ 就绪                                             窗口: 1200x800 │
└─────────────────────────────────────────────────────────────┘
```

## 图表交互说明

### 1. **滚动查看**
- **垂直滚动**：使用鼠标滚轮或右侧滚动条
- **水平滚动**：按住Shift键同时使用鼠标滚轮或底部滚动条

### 2. **matplotlib工具栏功能**
```
[主页] [后退] [前进] [平移] [缩放] [配置子图] [保存]
```
- **主页**：恢复初始视图
- **后退/前进**：导航历史视图
- **平移**：拖动图表进行移动
- **缩放**：框选区域进行放大
- **保存**：将当前图表保存为图像文件

### 3. **图表标注说明**
- **彩色线条**：不同颜色的虚线表示不同分位数阈值
- **彩色标注点**：红色表示极端高估，橙色表示高估，绿色表示低估，深绿色表示极端低估
- **统计线**：灰色虚线表示历史价格均值

## 分析指标说明

### 1. **价格百分位**
- **定义**：当前价格在历史价格序列中的位置百分比
- **计算方法**：`百分位 = (低于当前价格的历史数据点数 / 总历史数据点数) × 100%`
- **示例**：85%表示当前价格高于85%的历史价格

### 2. **分位数阈值**
- **1%分位**：极端低估阈值，仅1%的历史价格低于此值
- **20%分位**：低估阈值，20%的历史价格低于此值
- **80%分位**：高估阈值，80%的历史价格低于此值
- **99%分位**：极端高估阈值，99%的历史价格低于此值

### 3. **价格状态判断**
| 百分位范围 | 价格状态 | 颜色标识 | 操作建议 |
|-----------|----------|----------|----------|
| ≥ 99% | 极端高估 | 🔴 红色 | 减仓或考虑做空 |
| 80%-99% | 高估 | 🟠 橙色 | 谨慎操作，部分减仓 |
| 20%-80% | 合理区间 | 🔵 蓝色 | 持有或按原计划操作 |
| 1%-20% | 低估 | 🟢 绿色 | 逢低买入 |
| ≤ 1% | 极端低估 | 🟢 深绿色 | 分批建仓 |

### 4. **基差分析**
- **基差** = 现货价格 - 期货价格
- **正基差**：现货价格高于期货价格（现货升水）
- **负基差**：现货价格低于期货价格（期货升水）

## 注意事项

### 1. **数据源限制**
- 数据来源于公开网站，可能受到网站访问限制
- 建议避免在短时间内频繁请求大量数据
- 数据准确性依赖于数据源的质量

### 2. **网络要求**
- 程序需要稳定的网络连接来获取数据
- 如果数据获取失败，请检查网络连接或稍后重试

### 3. **分析局限性**
- 历史数据范围影响分析结果的准确性
- 建议使用足够长的历史数据进行分析（至少3个月）
- 价格分析仅供参考，不构成投资建议

### 4. **性能注意事项**
- 获取长时间范围的数据可能需要较长时间
- 图表渲染大量数据时可能需要一些时间
- 建议先获取较短时间范围的数据进行测试

## 故障排除

### 1. **常见问题**

#### Q: 无法获取数据
- **检查网络连接**：确保计算机已连接到互联网
- **检查日期格式**：确保日期格式为YYYY-MM-DD
- **检查日期范围**：结束日期不应早于开始日期

#### Q: 图表显示异常
- **重启程序**：关闭并重新打开程序
- **检查matplotlib版本**：确保matplotlib版本≥3.4.0
- **清理缓存**：删除matplotlib缓存文件

#### Q: 中文显示乱码
- **安装中文字体**：确保系统已安装中文字体
- **检查字体配置**：程序已包含中文字体配置，如仍乱码可尝试修改代码中的字体设置

### 2. **错误信息处理**

| 错误信息 | 可能原因 | 解决方案 |
|----------|----------|----------|
| "日期格式错误" | 日期输入格式不正确 | 使用YYYY-MM-DD格式 |
| "结束日期早于开始日期" | 日期范围设置错误 | 调整日期范围 |
| "数据获取失败" | 网络问题或数据源不可用 | 检查网络连接或稍后重试 |
| "未找到商品数据" | 选择的商品在当前日期范围无数据 | 调整日期范围或选择其他商品 |

---

**免责声明**：本软件提供的数据和分析结果仅供参考，不构成任何投资建议。期货交易存在风险，投资者应独立判断并承担相应风险。开发者和软件提供方不对因使用本软件而产生的任何投资损失承担责任。
